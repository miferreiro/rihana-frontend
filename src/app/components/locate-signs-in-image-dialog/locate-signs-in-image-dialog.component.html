<!--
  ~ RIHANA Frontend
  ~
  ~ Copyright (C) 2021 David A. Ruano Ordás, José Ramón Méndez Reboredo,
  ~ Miguel Ferreiro Díaz
  ~
  ~ This program is free software: you can redistribute it and/or modify
  ~ it under the terms of the GNU General Public License as
  ~ published by the Free Software Foundation, either version 3 of the
  ~ License, or (at your option) any later version.
  ~
  ~ This program is distributed in the hope that it will be useful,
  ~ but WITHOUT ANY WARRANTY; without even the implied warranty of
  ~ MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
  ~ GNU General Public License for more details.
  ~
  ~ You should have received a copy of the GNU General Public
  ~ License along with this program.  If not, see
  ~ <http://www.gnu.org/licenses/gpl-3.0.html>.
-->

<div id="image-dialog" class="modal fade show" tabindex="-1" aria-labelledby="imageDialogLabel" aria-hidden="false">
	<div id="modal" class="modal-dialog modal-dialog-centered modal-fullscreen">
		<div class="modal-content">
			<div class="modal-header-custom">
				<h5 class="modal-title" id="exampleModalLabel">{{'Finding and storing radiological signs' | translate}} </h5>
				<div class="modal-options">
					<i *ngIf="!disabled" class="bi bi-check-circle me-2" style="color: green;" (click)="onSave()"></i>
					<i class="bi bi-x-circle" style="color: red;" (click)="onCancel()"></i>
				</div>
			</div>
			<div class="row modal-body-custom">
				<div id="section-radiograph" class="col-xxl-6 col-lg-8 col-md-12 col-sm-12 align-self-start m-auto">
					<span class="control-options d-flex justify-content-between">
						<div>
							<span>
								{{'Brightness' | translate}}:
								<input name="radiograph" type="number" min="0" max="200" value="{{brightness}}"
										(input)="changeBrightness($event)">
								%
							</span>

							<span>
								{{'Contrast' | translate}}:
								<input name="radiograph" type="number" min="0" max="200" value="{{contrast}}"
										(input)="changeContrast($event)">
								%
							</span>
						</div>
						<div>
							<span class="resetRadiograph">
								<div class="btn-group" role="group">
								<i name="radiograph" class="bi bi-arrow-clockwise" style="font-size: 1rem; color: black;"
									(click)="resetRadiography()"></i>
								</div>
							</span>
						</div>
					</span>
					<div class="img-div">
						<div>
							<app-image-annotator id="image-annotator" [src]="src" [signs]="signs" [disabled]="disabled"
													(newSign)="setLocationNewSign($event)"
													[(contrast)]="contrast" [(brightness)]="brightness"
													(newSetScaleFactorImage)="setScaleFactorImage($event)"
													(removeSign)="removeSign($event)">
							</app-image-annotator>
						</div>
					</div>
				</div>
				<div id="section-signs" class="col-xxl-6 col-lg-12 col-md-12 col-sm-12 m-auto">
					<div class="row">
						<h5 class="text-center fw-bold text-dark mt-4 mb-4">
							{{'ModalTitleFindingsSigns' | translate:"{count:" + countSignDetected() + "}"}}
						</h5>
					</div>
					<div class="row signs">
						<div class="col">
							<div class="row">
								<div class="p-3 col-custom-6 col-xxl-12 col-lg-6 col-md-12 col-sm-12">
									<div class="card">
										<div class="card-header-custom">
											<div class="header d-flex justify-content-between">
												<h6>{{'Other'| translate}}</h6>
												<input class="check" type="checkbox" id="other" [checked]="other" (change)="checkOther($event)">
											</div>
										</div>
									</div>
								</div>
								<ng-container *ngFor="let signType of listSignTypes()">
									<div *ngIf="signType.code != 'NOF' && signType.code != 'OTH'" class="p-3 col-custom-6 col-xxl-12 col-lg-6 col-md-12 col-sm-12">
										<div class="card">
											<div class="card-header-custom">
												<div class="header d-flex justify-content-between">
													<h6>{{signType.name | translate}}</h6>
													<div>
														<i *ngIf="signsType(signType).length > 0"
															[ngClass]="{'bi bi-eye': checkRenderSomeSingType(signType), 'bi bi-eye-slash': !checkRenderSomeSingType(signType)}"
															(click)="showSignType(signType, $event)"></i>
														<i *ngIf="signsType(signType).length > 0 && !disabled" class="bi bi-trash"
															(click)="removeSignType(signType)"></i>
													</div>
												</div>
											</div>
											<span class="position-absolute top-0 start-100 translate-middle badge rounded-pill"
													[ngStyle]="{'background-color': signType.primaryColor,
																'color': signType.secondaryColor}">
													{{signsType(signType).length}}
											</span>
											<div *ngIf="signsType(signType).length > 0" class="card-body-custom">
												<ul class="list-group">
													<li *ngFor="let sign of signsType(signType); let indexSign = index"
														class="d-flex justify-content-between">
														<details>
															<summary>
																{{sign.id}} (<var>{{'Area' | translate}}</var>: {{sign.location?.area() | pixelsToMms | number : '1.0-0' : localizationService.getCurrentLocaleId()}}mm²)
															</summary>
															<span>
																{{'Location' | translate}}:
																<ul>
																	<li>
																		<var>x</var>: {{sign.location?.x | pixelsToMms | number : '1.0-0' : localizationService.getCurrentLocaleId()}}mm
																		<var>y</var>: {{sign.location?.y | pixelsToMms | number : '1.0-0' : localizationService.getCurrentLocaleId()}}mm
																	</li>
																	<li>
																		<var>{{'Width' | translate}}</var>: {{sign.location?.width | pixelsToMms | number : '1.0-0' : localizationService.getCurrentLocaleId()}}mm
																		<var>{{'Height' | translate}}</var>: {{sign.location?.height | pixelsToMms | number : '1.0-0' : localizationService.getCurrentLocaleId()}}mm
																	</li>
																</ul>
															</span>
														</details>
														<span class="col-auto text-center">
															<i [ngClass]="{'bi bi-eye': sign.render, 'bi bi-eye-slash': !sign.render}"
																(click)="showSign(sign, $event)"></i>
															<i *ngIf="!disabled" class="bi bi-trash" (click)="removeSign(sign)"></i>
														</span>
													</li>
												</ul>
											</div>
										</div>
									</div>
								</ng-container>
							</div>
						</div>
					</div>
				</div>
			</div>
		</div>
	</div>
</div>

<div *ngIf="showSelectSignType" id="selectSigns" class="modal fade show" data-bs-backdrop="static" aria-hidden="true"
		aria-labelledby="selectSigns" tabindex="-1">
	<div class="modal-dialog modal-dialog-centered modal-md">
		<div class="modal-content">
			<div class="modal-header justify-content-center">
				<h5 class="modal-title">{{'Select the sign type' | translate}}</h5>
				<button type="button" class="btn-close" aria-label="Close" (click)="closeNewSign()"></button>
			</div>
			<div class="modal-body">
				<ul class="list-group list-group-flush">
					<ng-container *ngFor="let signType of listSignTypes()">
						<li *ngIf="signType.code != 'NOF' && signType.code != 'OTH'" (click)="addSign(signType)" class="list-group-item">
							{{signType.name | translate}}
						</li>
					</ng-container>
				</ul>
			</div>
		</div>
	</div>
</div>