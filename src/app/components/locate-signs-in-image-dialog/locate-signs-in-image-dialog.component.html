<!--
  ~ RIHANA Frontend
  ~
  ~ Copyright (C) 2021 David A. Ruano Ordás, José Ramón Méndez Reboredo,
  ~ Miguel Ferreiro Díaz
  ~
  ~ This program is free software: you can redistribute it and/or modify
  ~ it under the terms of the GNU General Public License as
  ~ published by the Free Software Foundation, either version 3 of the
  ~ License, or (at your option) any later version.
  ~
  ~ This program is distributed in the hope that it will be useful,
  ~ but WITHOUT ANY WARRANTY; without even the implied warranty of
  ~ MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
  ~ GNU General Public License for more details.
  ~
  ~ You should have received a copy of the GNU General Public
  ~ License along with this program.  If not, see
  ~ <http://www.gnu.org/licenses/gpl-3.0.html>.
-->

<div id="image-dialog" class="modal fade show" tabindex="-1" aria-labelledby="imageDialogLabel" aria-hidden="false">
	<div id="modal" class="modal-dialog modal-dialog-centered modal-fullscreen">
		<div class="modal-content">
			<div class="modal-header-custom">
				<h1 class="modal-title h5" id="exampleModalLabel">{{'Finding and storing radiological signs' | translate}} </h1>
				<div class="modal-options">
					<i *ngIf="!disabled" title="{{'Confirm' | translate}}" class="bi bi-check-circle me-2"
					   style="font-size:1.5rem;color: green;" (click)="onSave()"></i>
					<i title="{{'Cancel' | translate}}" class="bi bi-x-circle" style="font-size:1.5rem;color: red;"
					   (click)="onCancel()"></i>
				</div>
			</div>
			<div class="row modal-body-custom">
				<div id="section-radiograph" class="col-xxl-6 col-lg-8 col-md-12 col-sm-12 align-self-start m-auto">
					<div class="col-11">
						<div class="img-div">
							<div>
								<app-image-annotator id="image-annotator" [src]="src" [signs]="signs" [disabled]="disabled"
														(newSign)="setLocationNewSign($event)"
														[(contrast)]="contrast" [(brightness)]="brightness"
														(newSetScaleFactorImage)="setScaleFactorImage($event)"
														(removeSign)="removeSign($event)">
								</app-image-annotator>
							</div>
						</div>
					</div>
					<span class="col-1 control-options d-flex justify-content-between">
						<div class="">
							<span class="row">
								<!-- {{'Brightness' | translate}}: -->

								<label for="radiograph"><i class="bi bi-brightness-high"></i></label>
								<input name="radiograph" type="number" min="0" max="200" value="{{brightness}}"
										(input)="changeBrightness($event)">
								%
							</span>

							<span class="row">
								<!-- {{'Contrast' | translate}}: -->
								<label for="radiograph"><i class="bi bi-circle-half"></i></label>
								<input name="radiograph" type="number" min="0" max="200" value="{{contrast}}"
										(input)="changeContrast($event)">
								%
							</span>
						</div>
						<div class="row" style="place-self: center">
							<span class="resetRadiograph">
								<div class="btn-group" role="group">
									<i title="{{'Focus' | translate}}" name="radiograph" class="las la-compress-arrows-alt la-lg me-2"
									   style="color: black;" (click)="resetPositionRadiography()"></i>
									<i title="{{'Reset' | translate}}" name="radiograph" class="las la-undo-alt la-lg"
									   style="color: black;" (click)="resetRadiography()"></i>
								</div>
							</span>
						</div>
					</span>
				</div>
				<div id="section-signs" class="col-xxl-6 col-lg-12 col-md-12 col-sm-12 m-auto">
					<div class="row">
						<h2 class="mt-4 mb-4 h5 text-center fw-bold text-dark">
							{{'ModalTitleFindingsSigns' | translate:"{count:" + countSignDetected() + "}"}}
						</h2>
					</div>
					<div class="row signs">
						<div class="col">
							<div *ngIf="!disabled || (disabled && other)" class="row">
								<div class="p-3 col-12">
									<div class="card">
										<div class="card-header-custom">
											<div class="header d-flex justify-content-between">
												<h3 class="h6">{{'Other'| translate}}</h3>
												<input id="other" type="checkbox" class="check"
													   [checked]="other" [disabled]="disabled"
													   (change)="checkOther($event)">
											</div>
										</div>
									</div>
								</div>
							</div>
							<div class="row">
								<ng-container *ngFor="let signType of listSignTypes()">
									<div *ngIf="signType.code != 'NOF' && signType.code != 'OTH' && signsType(signType).length > 0" class="p-3 col-custom-6 col-xxl-12 col-lg-6 col-md-12 col-sm-12">
										<div class="card">
											<div class="card-header-custom">
												<div class="header d-flex justify-content-between">
													<h3 class="h6">{{signType.name | translate}}</h3>
													<div>
														<i *ngIf="signsType(signType).length > 0"
															[ngClass]="{'bi bi-eye': checkRenderSomeSingType(signType), 'bi bi-eye-slash': !checkRenderSomeSingType(signType)}"
															(click)="showSignType(signType, $event)"></i>
														<i *ngIf="signsType(signType).length > 0 && !disabled"
															class="las la-trash-alt la-lg"
															(click)="removeSignType(signType)"></i>
													</div>
												</div>
											</div>
											<span class="position-absolute top-0 start-100 translate-middle badge rounded-pill"
													[ngStyle]="{'background-color': signType.primaryColor,
																'color': signType.secondaryColor}">
													{{signsType(signType).length}}
											</span>
											<div *ngIf="signsType(signType).length > 0" class="card-body-custom">
												<ul class="list-group">
													<li *ngFor="let sign of signsType(signType); let indexSign = index"
														class="d-flex justify-content-between">
														<details>
															<summary>
																{{sign.type.code + indexSign}} (<var>{{'Area' | translate}}</var>: {{sign.location?.area() | pixelsToMms | number : '1.0-0'}}mm²)
															</summary>
															<span>
																{{'Location' | translate}}:
																<ul>
																	<li>
																		<var>x</var>: {{sign.location?.x | pixelsToMms | number : '1.0-0'}}mm
																		<var>y</var>: {{sign.location?.y | pixelsToMms | number : '1.0-0'}}mm
																	</li>
																	<li>
																		<var>{{'Width' | translate}}</var>: {{sign.location?.width | pixelsToMms | number : '1.0-0'}}mm
																		<var>{{'Height' | translate}}</var>: {{sign.location?.height | pixelsToMms | number : '1.0-0'}}mm
																	</li>
																</ul>
															</span>
														</details>
														<span class="col-auto text-center">
															<i [ngClass]="{'bi bi-eye': sign.render, 'bi bi-eye-slash': !sign.render}"
																(click)="showSign(sign, $event)"></i>
															<i *ngIf="!disabled" class="las la-trash-alt"
																(click)="removeSign(sign)"></i>
														</span>
													</li>
												</ul>
											</div>
										</div>
									</div>
								</ng-container>
							</div>
						</div>
					</div>
				</div>
			</div>
		</div>
	</div>
</div>

<div *ngIf="showSelectSignType" id="selectSigns" class="modal fade show" data-bs-backdrop="static" aria-hidden="true"
		aria-labelledby="selectSigns" tabindex="-1">
	<div class="modal-dialog modal-dialog-centered modal-md">
		<div class="modal-content">
			<div class="modal-header justify-content-center">
				<h2 class="modal-title h5">{{'Select the sign type' | translate}}</h2>
				<button type="button" class="btn-close" aria-label="Close" (click)="closeNewSign()"></button>
			</div>
			<div class="modal-body">
				<ul class="list-group list-group-flush">
					<ng-container *ngFor="let signType of listSignTypes()">
						<li *ngIf="signType.code != 'NOF' && signType.code != 'OTH'" (click)="addSign(signType)" class="list-group-item">
							{{signType.name | translate}}
						</li>
					</ng-container>
				</ul>
			</div>
		</div>
	</div>
</div>