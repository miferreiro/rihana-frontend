<!--
  ~ RIHANA Frontend
  ~
  ~ Copyright (C) 2021-2022 David A. Ruano Ordás, José Ramón Méndez Reboredo,
  ~ Miguel Ferreiro Díaz
  ~
  ~ This program is free software: you can redistribute it and/or modify
  ~ it under the terms of the GNU General Public License as
  ~ published by the Free Software Foundation, either version 3 of the
  ~ License, or (at your option) any later version.
  ~
  ~ This program is distributed in the hope that it will be useful,
  ~ but WITHOUT ANY WARRANTY; without even the implied warranty of
  ~ MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
  ~ GNU General Public License for more details.
  ~
  ~ You should have received a copy of the GNU General Public
  ~ License along with this program.  If not, see
  ~ <http://www.gnu.org/licenses/gpl-3.0.html>.
-->

<div *ngIf="(exploration.report != undefined && isEditing) || !checkState('READ_ONLY')" class="row mt-4 mb-4">
	<div class="row align-items-center">
		<div class="col-xxl-6 col-12">
			<div class="row type-report-title">
				<h2 class="h4 fw-bold">{{'Report type' | translate}}</h2>
			</div>
		</div>
		<div class="col-xxl-6 col-12">
			<div class="row mt-2 mb-2">
				<div class="w-100 btn-group" role="group" aria-label="Set report type">
					<input type="radio" class="btn-check" name="btnradioManual" id="btnradioManual" autocomplete="off"
					[checked]="getReportType() === 'MANUAL'" (click)="setReportType('MANUAL')">
					<label class="btn btn-outline-primary" for="btnradioManual">{{'MANUAL' | translate}}</label>
					<input type="radio" class="btn-check" name="btnradioFile" id="btnradioFile" autocomplete="off"
					[checked]="getReportType() === 'FILE'" (click)="setReportType('FILE')">
					<label class="btn btn-outline-primary" for="btnradioFile">{{'FILE' | translate}}</label>
				</div>
			</div>
		</div>
	</div>
</div>

<div *ngIf="(exploration.report != null || isEditing) && showReport('FILE')" class="row mt-4 mb-4">
	<div class="row align-items-center">
		<div class="col-xxl-6 col-12">
			<div class="row report-title">
				<h2 class="h3 fw-bold">{{'Radiology report' | translate}}</h2>
				<div *ngIf="!checkState('NOT_LOADED')">
					<i title="{{'Expand/Collapse' | translate}}" id="expandControl" class="las la-eye-slash la-lg"
					(click)="expandReport()"></i>
				</div>
			</div>
		</div>
		<div class="col-xxl-6 col-12">
			<div class="row">
				<div *ngIf="checkState('NOT_LOADED') || checkState('FILE_LOADED')"
					 [ngClass]="{'col-6': checkState('NOT_LOADED'),
								 'col-12': checkState('FILE_LOADED')}">
					<div class="file-drop-zone" file-drop-zone [control]="controlReport">
						<label *ngIf="checkState('NOT_LOADED')" class="upload-input ng-trigger ng-trigger-zoomAnimation">
							<div class="col text-center">
								<i class="las la-file-upload la-lg" style="color: black;"></i>
							</div>
							<div class="col text text-center">
								{{'Drag and Drop the file or click here' | translate}}
							</div>
							<input class="files-input" type="file" accept=".pdf"
								(change)="addFile($event)" onclick="this.value = null">
						</label>
						<ng-template #placeholder>
							<div class="overlayCustom">
								<div class="text-center">
									<i class="las la-file-upload la-lg" style="color: black;"></i>
								</div>
								<div class="dragover-text">
									{{'Drop it here' | translate}}
								</div>
							</div>
						</ng-template>
						<div *ngIf="checkState('FILE_LOADED')">
							<div class="upload-list">
								<div>
									<div class="file-upload-icon">
										<i class="bi bi-file-earmark-pdf" style="font-size: 1.2rem; color: black;"></i>
									</div>
									<div class="file-info">
										{{controlReport.value[0].name}} ({{controlReport.value[0].size | humanFileSize}})
									</div>
									<div class="file-buttons">
										<span class="remove-btn" (click)="removeReport()">
											<i class="las la-trash-alt la-lg" style="color: black;"></i>
											{{'Remove' | translate}}
										</span>
									</div>
								</div>
							</div>
						</div>
					</div>
				</div>
				<div *ngIf="checkState('NOT_LOADED') || checkState('CLIPBOARD_LOADED')"
					 [ngClass]="{'col-6': checkState('NOT_LOADED'),
								 'col-12': checkState('CLIPBOARD_LOADED')}">
					<div *ngIf="checkState('NOT_LOADED')" class="file-paste-zone text-center" (click)="onPaste($event)">
						<i class="las la-clipboard la-lg" style="color: black;"></i>
						<p>
							{{'Click here to paste from clipboard' | translate}}
						</p>
					</div>
					<div *ngIf="checkState('CLIPBOARD_LOADED')" class="file-paste-zone text-center">
						<p>
							{{'Report loaded correctly from clipboard' | translate}}
						</p>
						<div class="file-buttons">
							<span class="remove-btn" (click)="removeReport()">
								<i class="las la-trash-alt la-lg" style="color: black;"></i>
								{{'Remove' | translate}}
							</span>
						</div>
					</div>
				</div>
				<div *ngIf="checkState('READ_ONLY')" class="col-12">
					<div class="file-paste-zone defaultCursor text-center">
						<p>
							{{'Report loaded correctly' | translate}}
						</p>
					</div>
				</div>
				<div *ngIf="checkState('EXPLORATION_LOADED')" class="col-12">
					<div class="file-paste-zone defaultCursor text-center report-loaded">
						<p>
							{{'Report loaded correctly' | translate}}
						</p>
						<span (click)="removeReport()">
							<i class="las la-trash-alt la-lg" style="color: black;"></i>
							{{'Remove' | translate}}
						</span>
					</div>
				</div>
			</div>
		</div>
	</div>
	<div *ngIf="patient.hasOwnProperty('birthdate')" id="dataReport" class="row mb-3 mt-3">
		<div class="align-items-center patient-info">
			<legend class="fw-bold">{{'Patient information' | translate}}</legend>
			<div class="row">
				<div class="col-md-3 col-sm-6 col-xs-12">
					<p class="text-nowrap fw-bold">{{'Birthdate' | translate}}</p>
				</div>
				<div class="col-md-3 col-sm-6 col-xs-12">
					<p>{{patient.hasOwnProperty("birthdate") ? (patient.birthdate | date: currentFormatDate) : ""}}</p>
				</div>
				<div class="col-md-3 col-sm-6 col-xs-12">
					<p class="fw-bold">{{'Sex' | translate}}</p>
				</div>
				<div class="col-md-3 col-sm-6 col-xs-12">
					<p>{{patient.hasOwnProperty("sex") ? (patient.sex | translate) : ""}}</p>
				</div>
			</div>
		</div>
		<div class="row align-items-center">
			<div class="col-md-3 col-sm-6 col-xs-12">
				<p class="fw-bold">{{'Completion date' | translate}}</p>
			</div>
			<div class="col-md-3 col-sm-6 col-xs-12">
				<p>{{report.hasOwnProperty("completionDate") ? (report.completionDate | date: currentFormatDate) : ""}}</p>
			</div>
			<div class="col-md-3 col-sm-6 col-xs-12">
				<p class="fw-bold">{{'Report number' | translate}}</p>
			</div>
			<div class="col-md-3 col-sm-6 col-xs-12">
				<p>{{report.hasOwnProperty("reportNumber") ? report.reportNumber : ""}}</p>
			</div>
		</div>
		<div class="row align-items-center">
			<div class="col-md-6 col-sm-6 col-xs-12">
				<p class="fw-bold">
					<span class="text-uppercase">{{'Applicant' | translate}}</span>
					{{'Center/Service' | translate}}
				</p>
			</div>
			<div class="col-md-6 col-sm-6 col-xs-12">
				<p>{{report.hasOwnProperty("applicant") ? report.applicant : ""}}</p>
			</div>
		</div>
		<div class="row align-items-center">
			<div class="col-md-3 col-sm-12 col-xs-12">
				<p class="fw-bold text-nowrap">
					<span class="text-uppercase">{{'Patient status' | translate}}</span>:
				</p>
			</div>
			<div class="col-md-3 col-sm-4 col-xs-12">
				<p class="text-nowrap">
					<span class="fw-bold">{{'Priority' | translate}}</span>
					{{report.hasOwnProperty("priority") ? report.priority : ""}}
				</p>
			</div>
			<div class="col-md-3 col-sm-4 col-xs-12">
				<p class="fw-bold">{{report.hasOwnProperty("status") ? report.status : ""}}</p>

			</div>
			<div class="col-md-3 col-sm-4 col-xs-12">
				<p *ngIf="report.hasOwnProperty('bed') && report.bed != undefined && report.bed != ''">
					<span class="fw-bold">{{'Bed' | translate}}</span>
					{{report.bed}}
				</p>
			</div>
		</div>
		<div class="row">
			<p class="fw-bold text-uppercase">{{'Requested explorations' | translate}}</p>
			<div class="table-responsive-md text-nowrap">
				<table class="table table-borderless text-center">
					<thead>
						<tr>
							<th scope="col">{{'Code' | translate}}</th>
							<th scope="col">{{'Description' | translate}}</th>
							<th scope="col">{{'Date' | translate}}</th>
						</tr>
					</thead>
					<tbody>
						<tr *ngFor="let exploration of report.requestedExplorations">
							<td>{{exploration.code}}</td>
							<td>{{exploration.description}}</td>
							<td>{{exploration.date | date: currentFormatDate}}</td>
						</tr>
					</tbody>
				</table>
			</div>
		</div>
		<div class="row">
			<p class="fw-bold text-uppercase">{{'Clinical data/Diagnostic suspicion of the application' | translate}}</p>
			<p>{{report.hasOwnProperty("clinicalData") ? report.clinicalData : ""}}</p>
		</div>
		<div class="row">
			<p class="fw-bold text-uppercase">{{'Performed explorations' | translate}}</p>
			<div class="table-responsive-md text-nowrap">
				<table class="table table-borderless text-center">
					<thead>
						<tr>
							<th scope="col">{{'Code' | translate}}</th>
							<th scope="col">{{'Description' | translate}}</th>
							<th scope="col">{{'Date' | translate}}</th>
							<th scope="col">{{'Portable' | translate}}</th>
							<th scope="col">{{'Surgery' | translate}}</th>
						</tr>
					</thead>
					<tbody>
						<tr *ngFor="let exploration of report.performedExplorations;">
							<td>{{exploration.code}}</td>
							<td>{{exploration.description}}</td>
							<td>{{exploration.date | date: currentFormatDate}}</td>
							<td>{{exploration.portable}}</td>
							<td>{{exploration.surgery}}</td>
						</tr>
					</tbody>
				</table>
			</div>
		</div>
		<div class="row">
			<p class="fw-bold text-uppercase">{{'Findings' | translate}}</p>
			<p>{{report.hasOwnProperty("findings") ? report.findings : ""}}</p>
		</div>
		<div *ngIf="report.hasOwnProperty('bed') && report.bed != undefined && report.bed != ''" class="row">
			<p class="fw-bold text-uppercase">{{'Conclusions' | translate}}</p>
			<p>{{report.hasOwnProperty("conclusions") ? report.conclusions : ""}}</p>
		</div>
	</div>
</div>
<div *ngIf="(exploration.report != null || isEditing) && showReport('MANUAL')" class="row mt-4 mb-4">
	<div class="row align-items-center">
		<div class="col-xxl-6 col-12">
			<div class="row report-title">
				<h2 class="h3 fw-bold">{{'Exploration data' | translate}}</h2>
			</div>
		</div>
		<div class="col-xxl-6 col-12 report-manual">
			<div *ngIf="exploration.title == undefined || isEditing || patient.sex != undefined" class="row mb-3">
				<p class="fw-bold my-2">{{'Sex' | translate}}</p>
				<ng-select id="report-form-sex"
						name="sex"
						[clearable]="true"
						[disabled] ="isDisabled()"
						[hideSelected]="true"
						[searchable]="false"
						[(ngModel)]="patient.sex"
						(ngModelChange)="update()">
					<ng-option *ngFor="let sex of keys(sexes)" [value]="sex">
						{{sex | translate | titlecase}}
					</ng-option>
				</ng-select>
			</div>
			<div *ngIf="exploration.title == undefined || isEditing || patient.birthdate != undefined" class="row my-3">
				<p class="fw-bold my-2">{{'Birthdate' | translate}}</p>
				<div *ngIf="!isDisabled()"
					 class="daterangerpicker"
					 daterangepicker
					 [options]="options"
					 (selected)="selectedDate($event)"
					 (applyDaterangepicker)="applyDate()"
					 (cancelDaterangepicker)="cancelDate()">
					<div class="d-flex justify-content-between h-100">
						<span *ngIf="patient.birthdate != undefined" class="ps-2 align-self-center">
							{{patient.birthdate | date: currentFormatDate}}
						</span>
						<span *ngIf="patient.birthdate == undefined" class="placeholder align-self-center">
							{{'Select a date' | translate}}
						</span>
						<div class="align-self-center">
						<span *ngIf="patient.birthdate != undefined" class="cancel" (click)="cancelDate()">×</span>
						<span>
							<button class="btn" aria-label="Calendar"><i class="bi bi-calendar"></i></button>
						</span>
						</div>
					</div>
				</div>
				<p *ngIf="isDisabled()">
					{{patient.birthdate | date: currentFormatDate}}
				</p>
			</div>
			<div *ngIf="exploration.title == undefined || isEditing || report.clinicalData != undefined" class="row my-3">
				<p class="fw-bold my-2">{{'Clinical data' | translate}}</p>
				<textarea *ngIf="!isDisabled()" name="clinicalData" class="form-control" style="max-height:100px" rows="2" maxlength="3000"
				[(ngModel)]="report.clinicalData" (ngModelChange)="update()"
				placeholder="{{'Add the clinical data here' | translate}}..."></textarea>
				<p *ngIf="isDisabled()">
					{{report.clinicalData}}
				</p>
			</div>
			<div *ngIf="exploration.title == undefined || isEditing || report.findings != undefined" class="row my-3">
				<p class="fw-bold my-2">{{'Findings' | translate}}</p>
				<textarea *ngIf="!isDisabled()" name="findings" class="form-control" style="max-height:100px" rows="2" maxlength="3000"
				[(ngModel)]="report.findings" (ngModelChange)="update()"
				placeholder="{{'Add the findings here' | translate}}..."></textarea>
				<p *ngIf="isDisabled()">
					{{report.findings}}
				</p>
			</div>
			<div *ngIf="exploration.title == undefined || isEditing || report.conclusions != undefined" class="row my-3">
				<p class="fw-bold my-2">{{'Conclusions' | translate}}</p>
				<textarea *ngIf="!isDisabled()" name="conclusions" class="form-control" style="max-height:100px" rows="2" maxlength="3000"
				[(ngModel)]="report.conclusions" (ngModelChange)="update()"
				placeholder="{{'Add the conclusions here' | translate}}..."></textarea>
				<p *ngIf="isDisabled()">
					{{report.conclusions}}
				</p>
			</div>
		</div>
	</div>
</div>

<simple-notifications></simple-notifications>