<!--
  ~ RIHANA Frontend
  ~
  ~ Copyright (C) 2021 David A. Ruano Ordás, José Ramón Méndez Reboredo,
  ~ Miguel Ferreiro Díaz
  ~
  ~ This program is free software: you can redistribute it and/or modify
  ~ it under the terms of the GNU General Public License as
  ~ published by the Free Software Foundation, either version 3 of the
  ~ License, or (at your option) any later version.
  ~
  ~ This program is distributed in the hope that it will be useful,
  ~ but WITHOUT ANY WARRANTY; without even the implied warranty of
  ~ MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
  ~ GNU General Public License for more details.
  ~
  ~ You should have received a copy of the GNU General Public
  ~ License along with this program.  If not, see
  ~ <http://www.gnu.org/licenses/gpl-3.0.html>.
-->

<div class="container pb-2">
	<div class="row summary mt-2 mb-3 text-center">
		<h2>{{'Sign types management' | translate}}</h2>
	</div>

	<div *ngIf="authenticationService.hasPermission(11, 1)" class="row mb-3">
		<div class="d-flex justify-content-start">
			<button type="button" class="input-group-text btn btn-success btn-sm" (click)="creatingSignType=true"
			        data-bs-toggle="modal" data-bs-target="#signTypeModal">
				<i class="las la-plus la-lg me-1"></i> {{'Add sign type' | translate}}
			</button>
		</div>
	</div>

	<form #signTypeForm="ngForm" (submit)="save(); signTypeForm.reset()" ngNativeValidate>
		<div id="signTypeModal" class="modal fade" tabindex="-1" aria-labelledby="signtypeModalLabel" data-bs-backdrop="static">
			<div class="modal-dialog modal-lg modal-fullscreen-md-down modal-dialog-centered">
				<div class="modal-content">
					<div class="modal-header">
						<h5 *ngIf="creatingSignType" class="modal-title">{{'Add sign type' | translate}}</h5>
						<h5 *ngIf="editingSignType" class="modal-title">{{'Edit sign type' | translate}}: "{{ signType.code }}"</h5>
					</div>
					<div class="modal-body">
						<section>
							<div *ngIf="creatingSignType" class="row mb-3">
								<label for="signtype-form-name" class="col-lg-6 col-md-12 col-form-label required fw-bold">
									{{'Code' | translate}}
								</label>
								<div class="col-lg-6 col-md-12">
									<input id="signtype-form-code" type="text" name="code" [(ngModel)]="signType.code" required
											pattern="[a-zA-ZñÑ0-9_-]{1,100}" title="{{'Must be a alphanumeric' | translate}}" #codeSignType="ngModel"/>
								</div>
								<div *ngIf="codeSignType.invalid  && !codeSignType.pristine" class="alert alert-danger my-0 py-1" role="alert">
									<div *ngIf="codeSignType.errors.required">
										{{'Code is required' | translate}}.
									</div>
									<div *ngIf="codeSignType.errors.pattern">
										{{'Code can only contain letters, numbers or underscore and should have a length between 1 and 100' | translate}}.
									</div>
								</div>
							</div>
							<div class="row mb-3">
								<label for="signtype-form-name" class="col-lg-6 col-md-12 col-form-label required fw-bold">
									{{'Name' | translate}}
								</label>
								<div class="col-lg-6 col-md-12">
									<input id="signtype-form-name" type="text" name="name" [(ngModel)]="signType.name" required
											pattern="[a-zA-ZñÑ0-9_-]{1,100}" title="{{'Must be a alphanumeric' | translate}}" #nameSignType="ngModel"/>
								</div>
								<div *ngIf="nameSignType.invalid && !nameSignType.pristine" class="alert alert-danger my-0 py-1" role="alert">
									<div *ngIf="nameSignType.errors.required">
										{{'Name is required' | translate}}.
									</div>
									<div *ngIf="nameSignType.errors.pattern">
										{{'Name can only contain letters, numbers or underscore and should have a length between 1 and 100' | translate}}.
									</div>
								</div>
							</div>
							<div class="row mb-3">
								<label for="signtype-form-description" class="col-lg-6 col-md-12 col-form-label required fw-bold">
									{{'Description' | translate}}
								</label>
								<div class="col-lg-6 col-md-12">
									<textarea style="max-height:100px" id="signtype-form-description" type="text" rows="3" maxlength="100" name="description" [(ngModel)]="signType.description" required
											pattern="[a-zA-ZñÑ0-9_-]{1,100}" title="{{'Must be a alphanumeric' | translate}}" #descriptionSignType="ngModel"></textarea>
								</div>
								<div *ngIf="descriptionSignType.invalid && !descriptionSignType.pristine" class="alert alert-danger my-0 py-1" role="alert">
									<div *ngIf="descriptionSignType.errors.required">
										{{'Description is required' | translate}}.
									</div>
									<div *ngIf="descriptionSignType.errors.pattern">
										{{'Description can only contain letters, numbers or underscore and should have a length between 1 and 100' | translate}}.
									</div>
								</div>
							</div>
							<div class="row mb-3">
								<label for="signtype-form-target" class="col-lg-6 col-md-12 col-form-label required fw-bold">
									{{'Target' | translate}}
								</label>
								<div class="col-lg-6 col-md-12">
									<input id="signtype-form-target" type="number" min="0" step="1" name="target" [(ngModel)]="signType.target" required
											pattern="[0-9]{0,100}" title="{{'Must be numeric' | translate}}" #targetSignType="ngModel"/>
								</div>
								<div *ngIf="targetSignType.invalid && !targetSignType.pristine" class="alert alert-danger my-0 py-1" role="alert">
									<div *ngIf="targetSignType.errors.required">
										{{'Target is required' | translate}}.
									</div>
									<div *ngIf="targetSignType.errors.pattern">
										{{'Target can only be positive numbers' | translate}}.
									</div>
								</div>
							</div>
							<div class="row mb-3">
								<label for="signtype-form-primaryColor" class="col-lg-6 col-md-12 col-form-label required fw-bold">
									{{'Primary color' | translate}}
								</label>
								<div class="col-lg-6 col-md-12">
									<div class="mb-2">
										<span class="mx-2">Color seleccionado:</span>
										<input type="color" value="{{signType.primaryColor}}" disabled>
									</div>
									<compact-picker [(color)]="signType.primaryColor" [control]="compactControlPrimaryColor"></compact-picker>
								</div>
								<div *ngIf="signType.primaryColor == '' || signType.primaryColor == undefined " class="alert alert-danger my-0 py-1" role="alert">
									No puede ser vacio
								</div>

							</div>

							<div class="row mb-3">
								<label for="signtype-form-secondaryColor" class="col-lg-6 col-md-12 col-form-label required fw-bold">
									{{'Secondary color' | translate}}
								</label>
								<div class="col-lg-6 col-md-12">
									<div class="mb-2">
										<span class="mx-2">Color seleccionado:</span>
										<input type="color" value="{{signType.secondaryColor}}" disabled>
									</div>
									<compact-picker [(color)]="signType.secondaryColor" [control]="compactControlSecondaryColor"></compact-picker>
								</div>
								<div *ngIf="signType.secondaryColor == '' || signType.secondaryColor == undefined " class="alert alert-danger my-0 py-1" role="alert">
									No puede ser vacio
								</div>
							</div>
						</section>
					</div>
					<div class="modal-footer py-1">
						<button #closeBtn type="button" class="btn btn-outline-secondary btn-sm" data-bs-dismiss="modal"
								(click)="cancel(); signTypeForm.reset()">
							{{'Cancel' | translate}}
						</button>
						<button *ngIf="creatingSignType" type="submit" class="btn btn-primary btn-sm"
								[disabled]="signTypeForm.invalid || signType.primaryColor === '' ||
								signType.primaryColor === undefined ||
								signType.primaryColor === '' ||
								signType.primaryColor === undefined">
							{{'Add' | translate}}
						</button>
						<button *ngIf="editingSignType" type="submit" class="btn btn-primary btn-sm"
								[disabled]="signTypeForm.invalid || signType.secondaryColor === '' ||
											signType.secondaryColor === undefined ||
											signType.secondaryColor === '' ||
											signType.secondaryColor === undefined">
							{{'Edit' | translate}}
						</button>
					</div>
				</div>
			</div>
		</div>
	</form>

	<div class="row table-responsive">
		<table class="table text-center align-middle">
			<thead>
				<tr>
					<th scope="col">{{'Code' | translate}}</th>
					<th scope="col">{{'Name' | translate}}</th>
					<!-- <th scope="col">{{'Description' | translate}}</th> -->
					<th scope="col">{{'Target' | translate}}</th>
					<th scope="col">{{'Primary color' | translate}}</th>
					<th scope="col">{{'Secondary color' | translate}}</th>
					<th scope="col" *ngIf="authenticationService.hasPermission(11, 2) || authenticationService.hasPermission(11, 3)">
						{{'Actions' | translate}}
					</th>
				</tr>
			</thead>
			<tbody>
				<tr *ngFor="let signType of signTypes">
					<td>{{signType.code}}</td>
					<td>{{signType.name | translate}}</td>
					<!-- <td>{{signType.description | translate}}</td> -->
					<td>{{signType.target}}</td>
					<td>
						<div class="cp_wrapper">
							<input type="color" value="{{signType.primaryColor}}" disabled>
						</div>
					</td>
					<td>
						<div class="cp_wrapper">
							<input type="color" value="{{signType.secondaryColor}}" disabled>
						</div>
					</td>
					<td *ngIf="authenticationService.hasPermission(11, 2) || authenticationService.hasPermission(11, 3)">
						<div class="btn-group" role="group">
							<button *ngIf="authenticationService.hasPermission(11, 3)" title="{{'Edit' | translate}}"
									class="btn border-end" data-bs-toggle="modal" data-bs-target="#signTypeModal"
									(click)="edit(signType.code)">
									<i class="las la-edit la-lg"></i>
							</button>
							<button *ngIf="authenticationService.hasPermission(11, 2)" title="{{'Remove' | translate}}"
									class="btn" (click)="remove(signType.code)"><i class="las la-trash-alt la-lg"></i></button>
						</div>
					</td>
				</tr>
			</tbody>
		</table>
		<div id="no-data-signTypes" [ngStyle]="{'display': signTypes.length == 0 ? 'block' : 'none', 'opacity': signTypes.length == 0 ? '1' : '0', 'visibility': signTypes.length == 0 ? 'visible' : 'hidden'}"
			 class="bg-light justify-content-center align-items-center">
			<span class="alert align-middle" role="alert">
				{{'No data to display' | translate}}
			</span>
		</div>
	</div>
</div>

<app-delete-confirmation [(open)]="deletingSignType" [modelName]="'signType'"
						 [id]="signType.code" [name]="signType.code"
						 (cancel)="cancel()" (confirm)="delete($event)">
</app-delete-confirmation>

<simple-notifications></simple-notifications>
