
<!--
  ~ RIHANA Frontend
  ~
  ~ Copyright (C) 2021 David A. Ruano Ordás, José Ramón Méndez Reboredo,
  ~ Miguel Ferreiro Díaz
  ~
  ~ This program is free software: you can redistribute it and/or modify
  ~ it under the terms of the GNU General Public License as
  ~ published by the Free Software Foundation, either version 3 of the
  ~ License, or (at your option) any later version.
  ~
  ~ This program is distributed in the hope that it will be useful,
  ~ but WITHOUT ANY WARRANTY; without even the implied warranty of
  ~ MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
  ~ GNU General Public License for more details.
  ~
  ~ You should have received a copy of the GNU General Public
  ~ License along with this program.  If not, see
  ~ <http://www.gnu.org/licenses/gpl-3.0.html>.
-->

<div class="row align-items-center">
	<div class="col-xxl-6 col-12">
		<ng-template [ngIf]="typeExploration === 'PA'">
			<h3 class="text-center fw-bold">{{'Postero-anterior radiograph (PA)' | translate}}</h3>
		</ng-template>
		<ng-template [ngIf]="typeExploration === 'AP'">
			<h3 class="text-center fw-bold">{{'Antero-posterior radiograph (AP)' | translate}}</h3>
		</ng-template>
		<ng-template [ngIf]="typeExploration === 'LAT'">
			<h3 class="text-center fw-bold">{{'Lateral radiograph (LAT)' | translate}}</h3>
		</ng-template>
	</div>
	<div class="col-xxl-6 col-12">
		<div class="row">
			<form *ngIf="!isRadiographLoaded && controlRadiograph.value.length == 0 || isRadiographLoaded && controlRadiograph.value.length > 0"
				[ngClass]="{'col-6': !isRadiographLoaded, 'col-12': isRadiographLoaded && controlRadiograph.value.length > 0}">
				<div class="file-drop-zone" file-drop-zone [control]="controlRadiograph">
					<label class="upload-input">
						<div class="col text-center">
							<i class="bi bi-upload" style="font-size: 1rem; color: black;"></i>
						</div>
						<div *ngIf="controlRadiograph.size === 0" class="col text text-center">
							{{'Drag and Drop the image or click here' | translate}}
						</div>
						<input name="inputRadiograph" class="files-input" type="file" accept="image/*"
								(change)="addRadiograph($event)" onclick="this.value = null">
					</label>

					<ng-template #placeholder>
						<div class="overlayCustom">
							<div class="text-center">
								<i class="bi bi-upload" style="font-size: 1rem; color: black;"></i>
							</div>
							<div class="dragover-text">
								{{'Drop it here' | translate}}
							</div>
						</div>
					</ng-template>

					<div *ngIf="controlRadiograph.value.length > 0">
						<div class="upload-list">
							<div>
								<div class="file-upload-icon">
									<i class="bi bi-file-image " style="font-size: 1rem; color: black;"></i>
								</div>
								<div class="file-info">
									{{controlRadiograph.value[0].name}} ({{controlRadiograph.value[0].size | humanFileSize}})
								</div>
								<div class="file-buttons">
									<span class="remove-btn" (click)="removeRadiograph()">
										<i class="bi bi-trash-fill" style="color: black;"></i>
										{{'Remove' | translate}}
									</span>
								</div>
							</div>
						</div>
					</div>
				</div>
			</form>
			<form *ngIf="!isRadiographLoaded && controlRadiograph.value.length == 0 || isRadiographLoaded && controlRadiograph.value.length == 0"
					[ngClass]="{'col-6': !isRadiographLoaded, 'col-12': isRadiographLoaded && controlRadiograph.value.length == 0}">
				<div *ngIf="!isRadiographLoaded" class="file-paste-zone text-center" (click)="onPaste($event)">
					<i class="bi bi-clipboard"></i>
					<p>
						{{'Click here to paste from clipboard' | translate}}
					</p>
				</div>
				<div *ngIf="isRadiographLoaded" class="file-paste-zone text-center">
					<p>
						{{'Report loaded correctly from clipboard' | translate}}
					</p>
					<div class="file-buttons">
						<span class="remove-btn" (click)="removeRadiograph()">
							<i class="bi bi-trash-fill" style="color: black;"></i>
							{{'Remove' | translate}}
						</span>
					</div>
				</div>
			</form>
		</div>
	</div>
</div>
<div *ngIf="controlRadiograph.value.length > 0" id="radiographInfo" class="row mb-3 mt-3">
	<div class="row">
		<h4 class="col">{{'Signs detected' | translate}}: {{radiograph.signs ? radiograph.signs.length : '0' }}</h4>
		<span class="col text-end">
			<i class="bi bi-brush" (click)="openDialogImage()"></i>
			<i class="bi bi-info-lg" (click)="openDialogImage(true)"></i>
		</span>
	</div>
	<div *ngIf="radiograph.signs != undefined" class="row signs">
		<ul>
			<li *ngFor="let sign of radiograph.signs" class="col-lg-4 col-md-6 col-12">
				<p *ngIf="sign.type.code != 'NOF' && sign.type.code != 'NON'" [ngStyle]="{'border-color': assignColorTypeSign(sign.type)}">
					{{sign.id}} (<var>{{'Area' | translate}}</var>: {{sign.location?.area() | pixelsToMms | number : '1.0-0' : localizationService.getCurrentLocaleId()}}mm²)
				</p>
				<p *ngIf="sign.type.code == 'NOF'" [ngStyle]="{'border-color': assignColorTypeSign(sign.type)}">
					{{sign.type.name | translate}}
				</p>
				<p *ngIf="sign.type.code == 'NON'" [ngStyle]="{'border-color': assignColorTypeSign(sign.type)}">
					{{sign.type.name | translate}}
				</p>
			</li>
		</ul>
	</div>
	<div class="row mt-4">
		<h4 class="col">{{'Observations' | translate}}: </h4>
		<textarea name="observations" class="form-control" [(ngModel)]="radiograph.observations"
				  placeholder="{{'Add your observations here' | translate}}..."></textarea>
	</div>
</div>

<app-locate-signs-in-image-dialog
	*ngIf="showImageDialog"
	(close)="closeDialogImage($event)"
	[src]="uploadedFile | async"
	[signs]="radiograph.signs"
	[disabled]="disabled">
</app-locate-signs-in-image-dialog>

<simple-notifications></simple-notifications>